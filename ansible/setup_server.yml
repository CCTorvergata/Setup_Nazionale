- name: "Set up vm"
  hosts: vm
  tasks:
    - name: Copy sniffer.sh
      copy:
        src: files/sniffer.sh
        dest: /usr/local/bin/sniffer.sh
        owner: root
        group: root
        mode: '0755'

    - name: Copy sniffer.service
      copy:
        src: files/sniffer.service
        dest: /usr/lib/systemd/system/sniffer.service
        owner: root
        group: root
        mode: '0644'

    - name: Reload systemd_service
      systemd_service:
        daemon_reload: true

    - name: Enable and start sniffer.service
      ansible.builtin.systemd_service:
        name: sniffer.service
        state: started
        enabled: true

    - name: Download firegex
      ansible.builtin.git:
        repo: https://github.com/Pwnzer0tt1/firegex
        dest: /root/firegex

    - name: Install python3.10
      ansible.builtin.apt:
        name: python3.10
        state: present

    - name: Start firegex
      ansible.builtin.command: "python3.10 start.py --build start --port 49123 --psw-no-interactive {{ lookup('file', 'files/password.txt') }}"
      args:
          chdir: /root/firegex
